<html>

<head>
    <title>Torrent Chaser</title>
</head>

<body>

    <h1> add magnetlink </h1>
    <div>
        <label>Input magnetlink</label>
        <div>
            <input id="input_add_torrent" type="text">
            <button id="btn_add_torrent">Add</button>
        </div>
        <div>
            <input id="input_remove_torrent" type="number">
            <button id="btn_remove_torrent">Remove</button>
        </div>
        <br>
        <hr>
        <br>
        <div>
            <button id="btn_show_torrent">Show Target Magnetlink</button>
            <ul id="output_add_torrent"></ul>
        </div>

    </div>
    <script>
        {
            let input_for_add = document.getElementById("input_add_torrent");
            let button_for_add = document.getElementById("btn_add_torrent");
            let input_for_remove = document.getElementById("input_remove_torrent");
            let button_for_remove = document.getElementById("btn_remove_torrent");

            function reqListener() {
                var ret = JSON.parse(this.responseText);
                console.log(ret);
            }
            button_for_add.addEventListener("click", function () {
                var oReq = new XMLHttpRequest();
                oReq.addEventListener("load", reqListener);
                oReq.open("POST", "/api/magnetlink/add");
                oReq.send(JSON.stringify({ "magnetlink": input_for_add.value }));
            })
            function reqListenerRemove() {
                var ret = JSON.parse(this.responseText);
                console.log(ret);
            }
            button_for_remove.addEventListener("click", function () {
                var oReq = new XMLHttpRequest();
                oReq.addEventListener("load", reqListenerRemove);
                oReq.open("POST", "/api/magnetlink/remove");
                oReq.send(JSON.stringify({ "id": parseInt(input_for_remove.value, 10) }));
            })
        }
        {

            let button_for_show = document.getElementById("btn_show_torrent");
            let ot = document.getElementById("output_add_torrent");

            function reqListener() {
                var ret = JSON.parse(this.responseText);
                console.log(ret);
                for (i = 0; i < ret["list"].length; i++) {
                    ot.insertAdjacentHTML("beforeend", "<li>[ " + ret["list"][i]["id"] + "]:" + ret["list"][i]["target"] + "</li>");
                }
            }
            button_for_show.addEventListener("click", function () {
                var oReq = new XMLHttpRequest();
                oReq.addEventListener("load", reqListener);
                oReq.open("POST", "/api/magnetlink/list");
                oReq.send();
            })


        }
    </script>


</body>

</html>